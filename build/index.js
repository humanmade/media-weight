(()=>{"use strict";const e=window.React,i=window.wp.i18n,t=window.wp.editor,d=window.wp.components,s=window.wp.plugins,n=window.wp.data,a=window.wp.blockEditor,r=window.wp.editPost,o=window.wp.coreData,l=window.wp.element,c=(0,l.forwardRef)((function({icon:e,size:i=24,...t},d){return(0,l.cloneElement)(e,{width:i,height:i,...t,ref:d})})),m=window.wp.primitives,h=window.ReactJSXRuntime,u=(0,h.jsx)(m.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)(m.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm-.75 12v-1.5h1.5V16h-1.5Zm0-8v5h1.5V8h-1.5Z"})});function g(){return g=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var d in t)({}).hasOwnProperty.call(t,d)&&(e[d]=t[d])}return e},g.apply(null,arguments)}const{mediaThreshold:p,featuredImageSize:w}=window.mediaWeightData,x="hm-media-weight",_=x,b=1048576,j=e=>e.reduce(((e,i)=>(["core/image","core/video"].includes(i.name)&&e.push(i),i.innerBlocks?e.concat(j(i.innerBlocks)):e)),[]);(0,s.registerPlugin)(x,{icon:function(i){return e.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 122.88 102.72"},i),e.createElement("path",{d:"M65.61 20.91v72.74h35.63c.38 0 .68.31.68.69v7.7c0 .38-.31.69-.68.69h-78.4c-.38 0-.69-.31-.69-.69v-7.7c0-.38.31-.69.69-.69h35.63V20.94a10.81 10.81 0 0 1-6.64-6.63H29.3v3.43c0 .38-.31.68-.68.68h-5.78a.69.69 0 0 1-.69-.68v-3.43h-5.73c-.44 0-.8-.31-.8-.68V7.84c0-.38.36-.69.8-.69h35.43C53.33 2.99 57.31 0 61.99 0s8.66 2.99 10.14 7.16h35.53c.44 0 .8.31.8.69v5.78c0 .38-.36.68-.8.68h-6.46v3.43c0 .38-.31.68-.68.68h-5.78a.69.69 0 0 1-.69-.68v-3.43H72.16c-1.07 3.07-3.49 5.5-6.55 6.6m34.05 1.39 22.91 40.48c.2.35.29.73.28 1.1h.02v.15c0 9.64-11.35 17.46-25.35 17.46-13.85 0-25.1-7.65-25.34-17.15a2.16 2.16 0 0 1 .31-1.71L95.92 22.2a2.13 2.13 0 0 1 2.91-.78c.37.23.65.53.83.88m.09 8.81v30.6h17.32zM95.67 61.7V31.16L77.96 61.7zM27.54 22.3l22.91 40.48c.2.35.29.73.28 1.1h.02v.15c0 9.64-11.35 17.46-25.35 17.46C11.55 81.49.3 73.84.06 64.34c-.04-.15-.06-.32-.06-.5 0-.44.14-.86.37-1.2L23.8 22.21a2.128 2.128 0 0 1 3.74.09m.09 8.81v30.6h17.32zM23.54 61.7V31.16L5.84 61.7zM61.99 6.07a4.69 4.69 0 1 1 0 9.38 4.69 4.69 0 0 1 0-9.38",style:{fillRule:"evenodd",clipRule:"evenodd"}}))},render:()=>{const{attachments:s,featuredImageId:l,blocksByAttributeId:m,mediaBlocks:g,imageCount:x,videoCount:v}=(()=>{const i=(0,n.useSelect)((e=>j(e(a.store).getBlocks()))),t=(0,n.useSelect)((e=>e("core/editor").getEditedPostAttribute("featured_media"))),{imageIds:d,videoIds:s,blocksByAttributeId:r}=(0,e.useMemo)((()=>{const e=[],d=[],s={};for(const t of i)t.attributes?.id&&(s[t.attributes.id]=t.clientId,"core/image"===t.name?e.push(t.attributes.id):"core/video"===t.name&&d.push(t.attributes.id));return 0!==t&&e.push(t),{imageIds:e,videoIds:d,blocksByAttributeId:s}}),[i,t]),l=(0,o.useEntityRecords)("postType","attachment",{per_page:d.length,include:d})?.records||[],c=(0,o.useEntityRecords)("postType","attachment",{per_page:s.length,include:s})?.records||[];return{attachments:l.concat(c),featuredImageId:t,blocksByAttributeId:r,mediaBlocks:i,imageCount:d.length,videoCount:s.length}})(),{selectBlock:f}=(0,n.useDispatch)(a.store),{openGeneralSidebar:y}=(0,n.useDispatch)(r.store);let I=0,z=0;const S=({imageCount:e,imagesSize:t,videoCount:d,videosSize:s})=>{const n=((t+s)/b).toFixed(2);let a;a=n>=0&&n<=p/2?"#1db231":n>=p/2&&n<=p?"#da6201":"#cf2e2e";const r=n>=p?(0,h.jsx)("p",{className:"description",style:{backgroundColor:"#1db231",borderRadius:"2px",color:"#fff",padding:"3px 6px"},children:(0,i.sprintf)(/* translators: %f: Maximum allowed size (in megabytes) for all media on page. */ /* translators: %f: Maximum allowed size (in megabytes) for all media on page. */
(0,i.__)("Warning! The media in this page exceeds the recommended threshold of %fmb","hm-media-weight"),p)}):null;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("p",{children:(0,h.jsxs)("strong",{children:[(0,i.__)("Total media size","hm-media-weight"),": "," ",(0,h.jsxs)("span",{style:{backgroundColor:a,borderRadius:"2px",color:"#fff",padding:"3px 6px"},children:[n,"mb"]})]})}),0!==e&&(0,h.jsxs)("p",{children:[(0,i.__)("Images total","hm-media-weight"),": ",(t/b).toFixed(2),"mb"]}),0!==d&&(0,h.jsxs)("p",{children:[(0,i.__)("Videos total","hm-media-weight"),": ",(s/b).toFixed(2),"mb"]}),r]})},k=s.map((e=>{const t=m[e.id],s=e.id!==l?(0,h.jsx)(d.Button,{className:"components-button is-compact is-secondary",onClick:()=>{f(t),y("edit-post/block")},children:(0,i.__)("Select associated block","hm-media-weight")}):"";let n="image"===e.media_type?(0,i.__)("Image","hm-media-weight"):(0,i.__)("Video","hm-media-weight");e.id===l&&(n=(0,i.__)("Featured image","hm-media-weight"));let a=e.media_details.filesize,r="";return"image"===e.media_type?(r=e.id!==l?g.find((e=>e.clientId===t))?.attributes?.sizeSlug:w||"full",a=e.meta?.intermediate_image_filesizes?.[r]||a,I+=a):z+=a,{attachment:e,thumbnail:"image"===e.media_type?e?.media_details?.sizes?.thumbnail?.source_url||e.source_url:null,type:n,mediaSize:a,blockButton:s,requestedSize:r}}));return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(t.PluginSidebarMoreMenuItem,{target:_,children:(0,i.__)("Media Weight sidebar","hm-media-weight")}),(0,h.jsxs)(t.PluginSidebar,{className:_,name:_,title:(0,i.__)("Media Weight","hm-media-weight"),children:[(0,h.jsxs)(d.PanelBody,{initialOpen:!0,title:(0,i.__)("Total Media Items","hm-media-weight"),children:[(0,h.jsx)("p",{children:x?(0,i.sprintf)(/* translators: %d: Number of WP-hosted images in post. */ /* translators: %d: Number of WP-hosted images in post. */
(0,i.__)("Images: %d","hm-media-weight"),x):(0,i.__)("No images","hm-media-weight")}),(0,h.jsx)("p",{children:v?(0,i.sprintf)(/* translators: %d: Number of WP-hosted videos in post. */ /* translators: %d: Number of WP-hosted videos in post. */
(0,i.__)("Videos: %d","hm-media-weight"),v):(0,i.__)("No videos","hm-media-weight")}),(0,h.jsx)(S,{imageCount:x,imagesSize:I,videoCount:v,videosSize:z})]}),(0,h.jsx)(d.PanelBody,{initialOpen:!1,title:(0,i.__)("Individual Media Items","hm-media-weight"),children:k.map((({attachment:e,thumbnail:t,type:s,mediaSize:n,blockButton:a,requestedSize:r})=>(0,h.jsx)(d.PanelRow,{children:(0,h.jsxs)("div",{children:[t?(0,h.jsx)("img",{src:t,alt:"",style:{maxWidth:"100%"}}):null,(0,h.jsx)("p",{children:(0,h.jsxs)("strong",{children:[s,": ",n<b?`${(n/1024).toFixed(2)}kb`:`${(n/b).toFixed(2)}mb`]})}),(0,h.jsxs)("p",{children:["Attachment ID: ",e.id,(0,h.jsx)("br",{}),(0,h.jsx)("small",{children:(0,h.jsx)("a",{href:`upload.php?item=${e.id}`,children:"Go to the attachment post â€º"})})]}),"full"===r&&(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(d.Flex,{direction:"row",align:"flex-start",gap:6,children:[(0,h.jsx)(d.FlexItem,{children:(0,h.jsx)(c,{icon:u,size:36})}),(0,h.jsx)(d.FlexItem,{children:(0,h.jsx)("p",{children:(0,h.jsx)("strong",{children:(0,i.__)("Full size image requested. Edit block to request smaller image.","hm-media-weight")})})})]})}),(0,h.jsxs)("details",{style:{display:"none",margin:"0.5rem 0 1rem"},children:[(0,h.jsx)("summary",{children:(0,i.__)("View entity record JSON","hm-media-weight")}),(0,h.jsx)("small",{children:(0,h.jsx)("pre",{children:JSON.stringify(e,null,2)})})]}),a,(0,h.jsx)("hr",{})]})},`media-details-${e.id}`)))})]})]})}})})();