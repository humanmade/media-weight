(()=>{"use strict";const e=window.React,i=window.wp.i18n,t=window.wp.editor,d=window.wp.components,s=window.wp.plugins,a=window.wp.data,n=window.wp.blockEditor,r=window.wp.coreData;function c(){return c=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var d in t)({}).hasOwnProperty.call(t,d)&&(e[d]=t[d])}return e},c.apply(null,arguments)}const o=window.ReactJSXRuntime,{mediaThreshold:l,featuredImageSize:m}=window.mediaWeightData,h="hm-media-weight",u=h,g=1048576,p=e=>e.reduce(((e,i)=>(["core/image","core/video"].includes(i.name)&&e.push(i),i.innerBlocks?e.concat(p(i.innerBlocks)):e)),[]);(0,s.registerPlugin)(h,{icon:function(i){return e.createElement("svg",c({xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 122.88 102.72"},i),e.createElement("path",{d:"M65.61 20.91v72.74h35.63c.38 0 .68.31.68.69v7.7c0 .38-.31.69-.68.69h-78.4c-.38 0-.69-.31-.69-.69v-7.7c0-.38.31-.69.69-.69h35.63V20.94a10.81 10.81 0 0 1-6.64-6.63H29.3v3.43c0 .38-.31.68-.68.68h-5.78a.69.69 0 0 1-.69-.68v-3.43h-5.73c-.44 0-.8-.31-.8-.68V7.84c0-.38.36-.69.8-.69h35.43C53.33 2.99 57.31 0 61.99 0s8.66 2.99 10.14 7.16h35.53c.44 0 .8.31.8.69v5.78c0 .38-.36.68-.8.68h-6.46v3.43c0 .38-.31.68-.68.68h-5.78a.69.69 0 0 1-.69-.68v-3.43H72.16c-1.07 3.07-3.49 5.5-6.55 6.6m34.05 1.39 22.91 40.48c.2.35.29.73.28 1.1h.02v.15c0 9.64-11.35 17.46-25.35 17.46-13.85 0-25.1-7.65-25.34-17.15a2.16 2.16 0 0 1 .31-1.71L95.92 22.2a2.13 2.13 0 0 1 2.91-.78c.37.23.65.53.83.88m.09 8.81v30.6h17.32zM95.67 61.7V31.16L77.96 61.7zM27.54 22.3l22.91 40.48c.2.35.29.73.28 1.1h.02v.15c0 9.64-11.35 17.46-25.35 17.46C11.55 81.49.3 73.84.06 64.34c-.04-.15-.06-.32-.06-.5 0-.44.14-.86.37-1.2L23.8 22.21a2.128 2.128 0 0 1 3.74.09m.09 8.81v30.6h17.32zM23.54 61.7V31.16L5.84 61.7zM61.99 6.07a4.69 4.69 0 1 1 0 9.38 4.69 4.69 0 0 1 0-9.38",style:{fillRule:"evenodd",clipRule:"evenodd"}}))},render:()=>{const{attachments:s,featuredImageId:c,blocksByAttributeId:h,mediaBlocks:w,imageCount:x,videoCount:b}=(()=>{const i=(0,a.useSelect)((e=>p(e(n.store).getBlocks()))),t=(0,a.useSelect)((e=>e("core/editor").getEditedPostAttribute("featured_media"))),{imageIds:d,videoIds:s,blocksByAttributeId:c}=(0,e.useMemo)((()=>{const e=[],d=[],s={};for(const t of i)t.attributes?.id&&(s[t.attributes.id]=t.clientId,"core/image"===t.name?e.push(t.attributes.id):"core/video"===t.name&&d.push(t.attributes.id));return 0!==t&&e.push(t),{imageIds:e,videoIds:d,blocksByAttributeId:s}}),[i,t]),o=(0,r.useEntityRecords)("postType","attachment",{per_page:d.length,include:d})?.records||[],l=(0,r.useEntityRecords)("postType","attachment",{per_page:s.length,include:s})?.records||[];return{attachments:o.concat(l),featuredImageId:t,blocksByAttributeId:c,mediaBlocks:i,imageCount:d.length,videoCount:s.length}})(),{selectBlock:_}=(0,a.useDispatch)(n.store);let j=0,v=0;const f=({imagesSize:e,videosSize:t})=>{const d=((e+t)/g).toFixed(2);let s;s=d>=0&&d<=l/2?"#1db231":d>=l/2&&d<=l?"#da6201":"#cf2e2e";const a=d>=l?(0,o.jsx)("p",{className:"description",style:{backgroundColor:"#1db231",borderRadius:"2px",color:"#fff",padding:"3px 6px"},children:(0,i.sprintf)(/* translators: %f: Maximum allowed size (in megabytes) for all media on page. */ /* translators: %f: Maximum allowed size (in megabytes) for all media on page. */
(0,i.__)("Warning! The media in this page exceeds the recommended threshold of %fmb","hm-media-weight"),l)}):null;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{children:(0,o.jsxs)("strong",{children:[(0,i.__)("Total media size","hm-media-weight"),": "," ",(0,o.jsxs)("span",{style:{backgroundColor:s,borderRadius:"2px",color:"#fff",padding:"3px 6px"},children:[d,"mb"]})]})}),(0,o.jsxs)("p",{children:[(0,i.__)("Images total","hm-media-weight"),": ",(e/g).toFixed(2),"mb"]}),(0,o.jsxs)("p",{children:[(0,i.__)("Videos total","hm-media-weight"),": ",(t/g).toFixed(2),"mb"]}),a]})},y=s.map((e=>{const t=h[e.id],s=e.id!==c?(0,o.jsx)(d.Button,{className:"components-button is-compact is-secondary",onClick:()=>_(t),children:(0,i.__)("Select associated block","hm-media-weight")}):"";let a="image"===e.media_type?(0,i.__)("Image","hm-media-weight"):(0,i.__)("Video","hm-media-weight");e.id===c&&(a=(0,i.__)("Featured image","hm-media-weight"));let n=e.media_details.filesize;if("image"===e.media_type){const i=e.id!==c?w.find((e=>e.clientId===t))?.attributes?.sizeSlug:m||"full";n=e.meta?.intermediate_image_filesizes?.[i]||n,j+=n}else v+=n;return{attachment:e,thumbnail:"image"===e.media_type?e?.media_details?.sizes?.thumbnail?.source_url||e.source_url:null,type:a,mediaSize:n,blockButton:s}}));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.PluginSidebarMoreMenuItem,{target:u,children:(0,i.__)("Media Weight sidebar","hm-media-weight")}),(0,o.jsxs)(t.PluginSidebar,{className:u,name:u,title:(0,i.__)("Media Weight","hm-media-weight"),children:[(0,o.jsxs)(d.PanelBody,{initialOpen:!0,title:(0,i.__)("Total Media Items","hm-media-weight"),children:[(0,o.jsxs)("p",{children:["Images: ",x]}),(0,o.jsxs)("p",{children:["Videos: ",b]}),(0,o.jsx)(f,{imagesSize:j,videosSize:v})]}),(0,o.jsx)(d.PanelBody,{initialOpen:!1,title:(0,i.__)("Individual Media Items","hm-media-weight"),children:y.map((({attachment:e,thumbnail:t,type:s,mediaSize:a,blockButton:n})=>(0,o.jsx)(d.PanelRow,{children:(0,o.jsxs)("div",{children:[t?(0,o.jsx)("img",{src:t,alt:"",style:{maxWidth:"100%"}}):null,(0,o.jsx)("p",{children:(0,o.jsxs)("strong",{children:[s,": ",a<g?`${(a/1024).toFixed(2)}kb`:`${(a/g).toFixed(2)}mb`]})}),(0,o.jsxs)("p",{children:["Attachment ID: ",e.id,(0,o.jsx)("br",{}),(0,o.jsx)("small",{children:(0,o.jsx)("a",{href:`upload.php?item=${e.id}`,children:"Go to the attachment post â€º"})})]}),(0,o.jsxs)("details",{style:{display:"none",margin:"0.5rem 0 1rem"},children:[(0,o.jsx)("summary",{children:(0,i.__)("View entity record JSON","hm-media-weight")}),(0,o.jsx)("small",{children:(0,o.jsx)("pre",{children:JSON.stringify(e,null,2)})})]}),n,(0,o.jsx)("hr",{})]})},`media-details-${e.id}`)))})]})]})}})})();